{"version":3,"file":"vue.js","sources":["../src/reactivity/computed.ts","../src/shared/index.ts","../src/reactivity/effect.ts","../src/reactivity/baseHandlers.ts","../src/reactivity/reactive.ts","../src/reactivity/ref.ts"],"sourcesContent":["export function computed(){\n    \n}","export const isObject = (val) => typeof val == 'object' && val !== null;\nexport const isSymbol = (val) => typeof val == 'symbol';\n\nexport const isArray = Array.isArray;\nexport const isInteger = (key) => '' + parseInt(key, 10) === key\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport const hasOwn = (val, key) => hasOwnProperty.call(val, key);\n\nexport const hasChanged = (value, oldValue) => value !== oldValue","import { isArray, isInteger } from \"../shared/index\";\n\nexport function effect(fn, options: any = {}) { // effect => vue2 watcher\n    const effect = createReactiveEffect(fn, options);\n    if (!options.lazy) {\n        effect();\n    }\n    return effect;\n}\nlet activeEffect; // 用来存储当前的effect函数\n\nlet uid = 0;\nconst effectStack = [];\nfunction createReactiveEffect(fn, options) {\n    const effect = function () {\n        if (!effectStack.includes(effect)) { // 防止递归执行\n            try {\n                activeEffect = effect;\n                effectStack.push(activeEffect)\n                return fn(); // 用户自己写的逻辑, 内部会对数据进行取值操作 ,在取值时 可以拿到这个activeAffect\n            } finally {\n                effectStack.pop();\n                activeEffect = effectStack[effectStack.length - 1];\n            }\n        }\n    }\n    effect.id = uid++;\n    effect.deps = []; // 用来表示 effect中依赖了那属性\n    effect.options = options;\n    return effect;\n}\n// {object:{key:[effect,effect]}}\n\nconst targetMap = new WeakMap(); // {target:{key:new Set()}}\n// 将属性和effect做一个关联\nexport function track(target, key) { // {{ name: 'zf', age: 11, address: '回龙观' }:{name:[effect],age:[effect]}}\n    if (activeEffect == undefined) {\n        return;\n    }\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    let dep = depsMap.get(key);\n    if (!dep) {\n        depsMap.set(key, (dep = new Set))\n    }\n    if (!dep.has(activeEffect)) { // 如果没有effect 就把effect放进到集合中\n        dep.add(activeEffect);\n        activeEffect.deps.push(dep); // 双向记忆的过程\n    }\n}\n// trigger属性\nexport function trigger(target, type, key, value?, oldValue?) {\n    const depsMap = targetMap.get(target);\n    if (!depsMap) {\n        return;\n    }\n    const run = effects => {\n        if (effects) effects.forEach(effect => effect());\n    }\n    // 数组有特殊的情况\n\n    if (key === 'length' && isArray(target)) {\n        depsMap.forEach((dep,key)=>{ // map 可以循环\n            if(key == 'length' || key >= value){ // 如果改的长度 小于数组原有的长度时 应该更新视图\n                run(dep);\n            }\n        })\n    } else {\n        // 对象的处理\n        if (key != void 0) { // 说明修改了key\n            run(depsMap.get(key));\n        }\n        switch (type) {\n            case 'add':\n                if(isArray(target)){ // 给数组如果通过索引增加选项\n                    if(isInteger(key)){\n                        run(depsMap.get('length')); // 因为如果页面中直接使用了数组也会对数组进行取值操作，会对length 进行收集，新增属性时直接触发length即可\n                    }\n                }\n                break;\n        \n            default:\n                break;\n        }\n    }\n}","import { track, trigger } from \"./effect\";\nimport { hasChanged, hasOwn, isArray, isInteger, isObject, isSymbol } from \"../shared/index\";\nimport { reactive } from \"./reactive\";\n\nfunction createGetter() {\n    return function get(target, key, receiver) {// 获取对象中的属性会执行此方法\n        const res = Reflect.get(target, key, receiver); // target[key];\n        // 如果取的值是symbol 类型 我要忽略他\n        if (isSymbol(key)) { // 数组中有很多symbol的内置方法 \n            return res;\n        }\n        // 依赖收集\n        console.log(key);\n        track(target, key);\n        console.log('此时数据做了获取的操作'); // todo...\n\n        if (isObject(res)) { // 取值是对象在进行代理 懒递归\n            return reactive(res);\n        }\n        return res;\n    }\n}\nfunction createSetter() {\n    return function set(target, key, value, receiver) { // 设置属性值的时候会执行此方法\n        // vue2不支持新增属性\n        // 新增还是修改?\n        const oldValue = target[key]; // 如果是修改那肯定有老值\n        // 看一下有没有这个属性 \n        // 第一种是 数组新增的逻辑  第二种是对象的逻辑\n        const hadKey = isArray(target) && isInteger(key) ? Number(key) < target.length : hasOwn(target, key);\n        const result = Reflect.set(target, key, value, receiver); //  target[key] = value;\n\n        // 新增属性是对象无所谓 ，只有取的时候才会做代理\n        if (!hadKey) {\n            trigger(target, 'add', key, value);\n\n        } else if (hasChanged(value, oldValue)) {\n            trigger(target, 'set', key, value, oldValue);\n        }\n        return result;\n    }\n}\nconst get = createGetter(); // 为了预置参数\nconst set = createSetter();\n\nexport const mutableHandlers = {\n    get,\n    set\n}","import { isObject } from \"../shared/index\";\nimport { mutableHandlers } from \"./baseHandlers\";\nexport function reactive(target){\n    // 我们需要将目标变成响应式对象，Proxy\n    return createReactiveObject(target,mutableHandlers); // 核心的操作就是当读取文件时做依赖收集，当数据变化时要重新执行effect\n}\nconst proxyMap = new WeakMap(); \nfunction createReactiveObject(target,baseHandlers){\n    // 如果不是对象直接不理你\n    if(!isObject(target)){\n        return target\n    }\n    const exisitingProxy = proxyMap.get(target);\n    if(exisitingProxy){\n        return exisitingProxy;\n    }\n    // 只是对最外层对象做代理 ，默认不会递归，而且不会重新重写对象中的属性\n    const proxy = new Proxy(target,baseHandlers);\n    proxyMap.set(target,proxy); // 将代理的对象和 代理后的结果做一个映射表\n    return proxy;\n}","export function ref(){\n    \n}"],"names":[],"mappings":";;;;;;aAAgB,QAAQ;IAExB;;ICFO,IAAM,QAAQ,GAAG,UAAC,GAAG,IAAK,OAAA,OAAO,GAAG,IAAI,QAAQ,IAAI,GAAG,KAAK,IAAI,GAAA,CAAC;IACjE,IAAM,QAAQ,GAAG,UAAC,GAAG,IAAK,OAAA,OAAO,GAAG,IAAI,QAAQ,GAAA,CAAC;IAEjD,IAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;IAC9B,IAAM,SAAS,GAAG,UAAC,GAAG,IAAK,OAAA,EAAE,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,KAAK,GAAG,GAAA,CAAA;IAEhE,IAAM,cAAc,GAAG,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC;IAEhD,IAAM,MAAM,GAAG,UAAC,GAAG,EAAE,GAAG,IAAK,OAAA,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,GAAA,CAAC;IAE3D,IAAM,UAAU,GAAG,UAAC,KAAK,EAAE,QAAQ,IAAK,OAAA,KAAK,KAAK,QAAQ,GAAA;;aCRjD,MAAM,CAAC,EAAE,EAAE,OAAiB;QAAjB,wBAAA,EAAA,YAAiB;QACxC,IAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC;QACjD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;YACf,MAAM,EAAE,CAAC;SACZ;QACD,OAAO,MAAM,CAAC;IAClB,CAAC;IACD,IAAI,YAAY,CAAC;IAEjB,IAAI,GAAG,GAAG,CAAC,CAAC;IACZ,IAAM,WAAW,GAAG,EAAE,CAAC;IACvB,SAAS,oBAAoB,CAAC,EAAE,EAAE,OAAO;QACrC,IAAM,MAAM,GAAG;YACX,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;gBAC/B,IAAI;oBACA,YAAY,GAAG,MAAM,CAAC;oBACtB,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;oBAC9B,OAAO,EAAE,EAAE,CAAC;iBACf;wBAAS;oBACN,WAAW,CAAC,GAAG,EAAE,CAAC;oBAClB,YAAY,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;iBACtD;aACJ;SACJ,CAAA;QACD,MAAM,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC;QAClB,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC;QACjB,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;QACzB,OAAO,MAAM,CAAC;IAClB,CAAC;IACD;IAEA,IAAM,SAAS,GAAG,IAAI,OAAO,EAAE,CAAC;IAChC;aACgB,KAAK,CAAC,MAAM,EAAE,GAAG;QAC7B,IAAI,YAAY,IAAI,SAAS,EAAE;YAC3B,OAAO;SACV;QACD,IAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpC,IAAI,CAAC,OAAO,EAAE;YACV,SAAS,CAAC,GAAG,CAAC,MAAM,GAAG,OAAO,GAAG,IAAI,GAAG,EAAE,EAAE,CAAA;SAC/C;QACD,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC3B,IAAI,CAAC,GAAG,EAAE;YACN,OAAO,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,EAAE,CAAA;SACpC;QACD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE;YACxB,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YACtB,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC/B;IACL,CAAC;IACD;aACgB,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,KAAM,EAAE,QAAS;QACxD,IAAM,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACtC,IAAI,CAAC,OAAO,EAAE;YACV,OAAO;SACV;QACD,IAAM,GAAG,GAAG,UAAA,OAAO;YACf,IAAI,OAAO;gBAAE,OAAO,CAAC,OAAO,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,EAAE,GAAA,CAAC,CAAC;SACpD,CAAA;;QAGD,IAAI,GAAG,KAAK,QAAQ,IAAI,OAAO,CAAC,MAAM,CAAC,EAAE;YACrC,OAAO,CAAC,OAAO,CAAC,UAAC,GAAG,EAAC,GAAG;gBACpB,IAAG,GAAG,IAAI,QAAQ,IAAI,GAAG,IAAI,KAAK,EAAC;oBAC/B,GAAG,CAAC,GAAG,CAAC,CAAC;iBACZ;aACJ,CAAC,CAAA;SACL;aAAM;;YAEH,IAAI,GAAG,IAAI,KAAK,CAAC,EAAE;gBACf,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;aACzB;YACD,QAAQ,IAAI;gBACR,KAAK,KAAK;oBACN,IAAG,OAAO,CAAC,MAAM,CAAC,EAAC;wBACf,IAAG,SAAS,CAAC,GAAG,CAAC,EAAC;4BACd,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;yBAC9B;qBACJ;oBACD,MAAM;aAIb;SACJ;IACL;;ICnFA,SAAS,YAAY;QACjB,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;YACrC,IAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;;YAE/C,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;gBACf,OAAO,GAAG,CAAC;aACd;;YAED,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;YACnB,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;YAE3B,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;gBACf,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC;aACxB;YACD,OAAO,GAAG,CAAC;SACd,CAAA;IACL,CAAC;IACD,SAAS,YAAY;QACjB,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;;;YAG5C,IAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;;;YAG7B,IAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,SAAS,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;YACrG,IAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;;YAGzD,IAAI,CAAC,MAAM,EAAE;gBACT,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;aAEtC;iBAAM,IAAI,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;gBACpC,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,KAAe,CAAC,CAAC;aAChD;YACD,OAAO,MAAM,CAAC;SACjB,CAAA;IACL,CAAC;IACD,IAAM,GAAG,GAAG,YAAY,EAAE,CAAC;IAC3B,IAAM,GAAG,GAAG,YAAY,EAAE,CAAC;IAEpB,IAAM,eAAe,GAAG;QAC3B,GAAG,KAAA;QACH,GAAG,KAAA;KACN;;aC9Ce,QAAQ,CAAC,MAAM;;QAE3B,OAAO,oBAAoB,CAAC,MAAM,EAAC,eAAe,CAAC,CAAC;IACxD,CAAC;IACD,IAAM,QAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;IAC/B,SAAS,oBAAoB,CAAC,MAAM,EAAC,YAAY;;QAE7C,IAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAC;YACjB,OAAO,MAAM,CAAA;SAChB;QACD,IAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC5C,IAAG,cAAc,EAAC;YACd,OAAO,cAAc,CAAC;SACzB;;QAED,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAC,YAAY,CAAC,CAAC;QAC7C,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAC,KAAK,CAAC,CAAC;QAC3B,OAAO,KAAK,CAAC;IACjB;;aCpBgB,GAAG;IAEnB;;;;;;;;;;;;;"}